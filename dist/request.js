function Base64(){this.getBytesFromString=function(a){for(var b=unescape(encodeURIComponent(a)),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return c},this.getStringFromBytes=function(a){var b,c="";for(b=0;b<a.length;b++)c+="%"+("0"+a[b].toString(16)).slice(-2);return c=decodeURIComponent(c)}}function Packet(a,b){this.operateCode=a,this.seq=b}Base64.prototype.keys=["789_-ABCDEFGHIJKLMNOPQRSTUVWXYZ6abcdefghijklmnopqrstuvwxyz501234","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-","3456789_-ABCDEFGHIJKLMNOPQRSTUVWX2YZabcdefghijklmnopqr1stuvwxyz0","-ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz9012345678","_-ABCDEFGHIJKLMNOPQRSTUVWXYZ9abcdefghijklmnopqrstuvwxyz801234567","9_-ABCDEFGHIJKLMNOPQRSTUVWXYZ8abcdefghijklmnopqrstuvwxyz70123456","6789_-ABCDEFGHIJKLMNOPQRSTUVWXYZ5abcdefghijklmnopqrstuvwxyz40123","89_-ABCDEFGHIJKLMNOPQRSTUVWXYZ7abcdefghijklmnopqrstuvwxyz6012345","456789_-ABCDEFGHIJKLMNOPQRSTUVWXY3Zabcdefghijklmnopqrs2tuvwxyz01","56789_-ABCDEFGHIJKLMNOPQRSTUVWXYZ4abcdefghijklmnopqrstuvwxyz3012"],Base64.prototype.encode=function(a){for(var b,c,d,e=Math.floor(Math.random()*this.keys.length),f=this.keys[e],g="~"+e,h=this.getBytesFromString(a),i=h.length,j=0;i>j;){if(b=255&h[j++],j==i){g+=f.charAt(b>>2),g+=f.charAt((3&b)<<4);break}if(c=h[j++],j==i){g+=f.charAt(b>>2),g+=f.charAt((3&b)<<4|(240&c)>>4),g+=f.charAt((15&c)<<2);break}d=h[j++],g+=f.charAt(b>>2),g+=f.charAt((3&b)<<4|(240&c)>>4),g+=f.charAt((15&c)<<2|(192&d)>>6),g+=f.charAt(63&d)}return g},Base64.prototype.decode=function(a){for(var b,c,d,e,f,g,h,i=a.substr(1,1),j=a.substr(2),k=this.keys[i],l=(j.length,[]),m=0;m<j.length;)e=k.indexOf(j.charAt(m++)),f=k.indexOf(j.charAt(m++)),g=k.indexOf(j.charAt(m++)),h=k.indexOf(j.charAt(m++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,b>0&&l.push(b),64!=g&&c>0&&l.push(c),64!=h&&d>0&&l.push(d);return this.getStringFromBytes(l)},Packet.prototype._intBitsToFloat=function(a){var b=new Int8Array(4),c=new Int32Array(b.buffer,0,1),d=new Float32Array(b.buffer,0,1);return c[0]=a,d[0]},Packet.prototype._getStringFromByteArray=function(a){var b,c="";for(b=0;b<a.length;b++)c+="%"+("0"+a[b].toString(16)).slice(-2);return decodeURIComponent(c)},Packet.prototype.input=function(a){this.buff=a},Packet.prototype.decode=function(a){var b,c=new Uint8Array(a),d=[];for(b=0;b<c.length;b++)d.push(c[b]);this.input(d);this.getInt(d);this.seq=this.getInt(d),this.operateCode=this.getInt(d);var e=this.getInt(),f=[];for(b=0;e>b;b++)f.push(this.decodeTable());var g={};if(!f)return g;for(b=0;b<f.length;b++){var h=f[b];g[h.name]=h.rows}return g},Packet.prototype.decodeTable=function(){var a={},b=this.getInt();if(b>this.buff.length)throw new Error("数据异常");a.name=this._getStringFromByteArray(this.get(b)).toLocaleLowerCase(),a.field=[];var c=[];a.rows=[];var d,e=this.getInt();for(d=0;e>d;d++){var f=this.decodeField();a.field.push(f),c.push(f.name)}var g=this.getInt();for(d=0;g>d;d++)a.rows.push(this.decodeRow(a.field));return a},Packet.prototype.decodeField=function(){var a={},b=this.buff.shift();a.type=String.fromCharCode(this.buff.shift()),a.precise=this.getShort(),a.length=this.getInt();var c=this.getInt();if(c>this.buff.length)throw new Error("数据异常");return a.name=this._getStringFromByteArray(this.get(c)).toLocaleLowerCase(),b>0&&this.buff.length>4&&(c=Math.min(this.getInt(),this.buff.length),a.caption=this._getStringFromByteArray(this.get(c))),a},Packet.prototype.decodeRow=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c],e=d.name;switch(d.type){case"B":var f=this.getInt();if(f>this.buff.length)throw new Error("数据异常");b[e]=this.get(f);break;case"S":if(f=this.getInt(),f>this.buff.length)throw new Error("数据异常");b[e]=this._getStringFromByteArray(this.get(f));break;case"C":b[e]=this.getChar();break;case"T":b[e]=this.getShort();break;case"N":b[e]=this.getInt();break;case"L":b[e]=this.getLong();break;case"1":b[e]=this.getCompressLong();break;case"2":b[e]=this.getCompressInt();break;case"3":b[e]=this.getCompressDateTime();break;case"F":b[e]=this.getFloat();break;case"D":b[e]=this.getDouble();break;default:console.log("未知类型:"+d.type)}}return b},Packet.prototype.get=function(a){for(var b=[],c=0;a>c;c++)b.push(this.buff.shift());return b},Packet.prototype.getChar=function(){String.fromCharCode(this.buff.shift())},Packet.prototype.getShort=function(){var a=this.buff.shift(),b=this.buff.shift();return a<<8|255&b},Packet.prototype.getInt=function(){var a=this.buff.shift(),b=this.buff.shift(),c=this.buff.shift(),d=this.buff.shift(),e=255&d;return e|=c<<8&65280,e|=b<<16&16711680,e|=a<<24&4278190080},Packet.prototype.getLong=function(){var a=(255&this.buff.shift())<<56>>>0,b=(255&this.buff.shift())<<48>>>0,c=(255&this.buff.shift())<<40>>>0,d=(255&this.buff.shift())<<32>>>0,e=(255&this.buff.shift())<<24>>>0,f=(255&this.buff.shift())<<16>>>0,g=(255&this.buff.shift())<<8>>>0,h=(255&this.buff.shift())>>>0,i=a|b|c|d,j=e|f|g|h,k=i*Math.pow(65536,2)+(0>j?Math.pow(65536,2):0)+j;return k},Packet.prototype.getCompressDateTime=function(){var a=this.getInt(),b=63&a,c=a>>>6&31,d=a>>>11&31,e=a>>>16&15,f=a>>>20&4095,g=1e10*f+1e8*e+1e6*d+1e4*c+100*b;return g},Packet.prototype.getCompressInt=function(){var a,b=0,c=0;do a=this.buff.shift(),0===c&&0!==(64&a)&&(b=4294967295),c++,b=b<<7|127&a;while(0===(128&a));return b},Packet.prototype.getCompressLong=function(){var a,b=0,c=0,d=0;do a=this.buff.shift(),0===d&&0!==(64&a)&&(b=4294967295,c=4294967295),d++,c=c<<7|b>>>25,b=b<<7|127&a;while(0===(128&a));return c*Math.pow(65536,2)+(0>b?Math.pow(65536,2):0)+b},Packet.prototype.getFloat=function(){return this._intBitsToFloat(this.getInt())},Packet.prototype.getDouble=function(){var a=255&this.buff.shift(),b=255&this.buff.shift(),c=255&this.buff.shift(),d=255&this.buff.shift(),e=255&this.buff.shift(),f=255&this.buff.shift(),g=255&this.buff.shift(),h=255&this.buff.shift(),i=128&a,j=(240&b)>>4;j+=(127&a)<<4;var k=h;switch(k+=g<<8,k+=f<<16,k+=e*Math.pow(2,24),k+=d*Math.pow(2,32),k+=c*Math.pow(2,40),k+=(15&b)*Math.pow(2,48),j){case 0:j=-1022;break;case 2047:return k?NaN:i?-(1/0):1/0;default:k+=Math.pow(2,52),j-=1023}return i&&(k*=-1),k*Math.pow(2,j-52)};var request=function(){return{get:function(a,b){b=b||{};var c=new XMLHttpRequest;c.open("get",a),c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=JSON.parse(c.responseText);b.success&&b.success(a)}},c.send()},packet:function(a,b){b=b||{};var c=new XMLHttpRequest;c.open("get",a),c.responseType="arraybuffer",c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=c.response,d=new Packet,e=d.decode(a);b.success&&b.success(e)}},c.send()},post:function(a,b){b=b||{};var c=new XMLHttpRequest;c.open("post",a),c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=JSON.parse(c.responseText);b.success&&b.success(a)}},c.send(b.data)}}}();
//# sourceMappingURL=request.js.map